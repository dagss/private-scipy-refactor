from bento.commands.hooks \
    import \
        pre_build, post_configure
from yaku.task_manager \
    import \
        set_file_hook

def fatima(self, node):
    pyext = __import__("pyext")
    return pyext.pycxx_hook(self, node)

@post_configure
def myconfigure(ctx):
    cfg = ctx.yaku_configure_ctx
    ldir = ctx.local_node.path_from(ctx.top_node)
    set_file_hook(cfg, ldir + "/src/_interpolate.cpp",
                  fatima)

@pre_build
def mybuild(ctx):
    bld = ctx.yaku_build_ctx

    env = {"PYEXT_SHLINKFLAGS": bld.env["FC_RUNTIME_LDFLAGS"][:],
           "PYEXT_LIBDIR": [ctx.local_node.path_from(ctx.top_node)],
           "PYEXT_LIBS": ["fitpack"]}
    ctx.register_environment("_fitpack", env)
    ctx.register_environment("dfitpack", env)
